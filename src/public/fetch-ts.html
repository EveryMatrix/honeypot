<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>fetching ts2</title>
    <script
            src="https://code.jquery.com/jquery-3.3.1.min.js"
            integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
            crossorigin="anonymous"></script>
</head>
<body>
<h1>Fetching ts2 data</h1>
<pre id="response"></pre>
<h2>Log here:</h2>
<pre id="log"></pre>
<script>
    const logstr = [];

    function log(m, l) {
        logstr.push({message: m, log: l});
        document.getElementById('log').innerHTML = JSON.stringify(logstr, false, 4);

    }

    function sendLog(r) {
        log('sendLog', r);
        const body = JSON.stringify(r, false, 4);
        document.getElementById('response').innerHTML = body;
        jQuery.ajax({
            url: '/add-sendLog',
            type: 'POST',
            data: body,
            dataType: 'jsonp',
            headers: {
                'content-type': 'application/json'
            },
        });
    }
    log('before ajax');
    jQuery.ajax({
            url: 'https://api-dev.everymatrix.com/longpoll/open',

            success: (data) => {
                log('success ajax', data);
                sendLog(data);
            },
            error: (request, status, error) => {
                log('error ajax', data);
                sendLog({request, error, status});
            }

        }
    )
    // // .then((r) => {
    // //     console.sendLog('r', r);
    // //     if (!r.ok) {
    // //         return {error: r.statusText, status: r.status};
    // //     }
    // //
    // //     return r.json();
    // // })
    //     .then((r) => {
    //
    //     }).catch((e) => {
    //     console.sendLog('e', e);
    //     e.then((er) => {
    //         console.sendLog('er', er);
    //         jQuery.ajax('/add-sendLog', {
    //             method: 'POST',
    //             body: JSON.stringify({error: er.toString()}, false, 4),
    //             headers: {
    //                 'content-type': 'application/json'
    //             },
    //         });
    //     })
    //
    // });
</script>
<noscript>no js run</noscript>

</body>
</html>